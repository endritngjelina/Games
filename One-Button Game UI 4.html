<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Jump - Enhanced Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --dark-bg: #0a0a1a;
            --darker-bg: #060613;
            --text-light: #f0f0ff;
            --text-accent: #00e6bf;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            --border-radius: 16px;
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        body {
            background: var(--dark-bg);
            color: var(--text-light);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            height: 95vh;
            background: linear-gradient(45deg, #0a0a1a, #060613, #02020d);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .background-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(102, 126, 234, 0.1) 0%, transparent 40%),
                        radial-gradient(circle at 80% 70%, rgba(118, 75, 162, 0.1) 0%, transparent 40%);
            z-index: 1;
            animation: backgroundPulse 15s infinite alternate;
        }

        @keyframes backgroundPulse {
            0% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        .star {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: twinkle 3s infinite alternate;
        }

        @keyframes twinkle {
            0% { opacity: 0.1; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1.2); }
        }

        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            pointer-events: none;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .score-value {
            font-size: 28px;
            font-weight: bold;
            background: var(--success-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .combo-display {
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transform: translateY(-10px);
            transition: var(--transition);
        }

        .combo-display.active {
            opacity: 1;
            transform: translateY(0);
            animation: comboPopup 0.5s ease-out;
        }

        @keyframes comboPopup {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .combo-count {
            color: var(--text-accent);
        }

        .theme-selector {
            display: flex;
            gap: 12px;
        }

        .theme-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .theme-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: inherit;
            border-radius: 50%;
            z-index: 1;
        }

        .theme-btn:hover, .theme-btn.active {
            border-color: white;
            transform: scale(1.15);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .theme-btn.classic { background: var(--primary-gradient); }
        .theme-btn.neon { background: var(--secondary-gradient); }
        .theme-btn.ocean { background: linear-gradient(135deg, #00c6ff, #0072ff); }
        .theme-btn.sunset { background: var(--danger-gradient); }

        .game-canvas-container {
            position: absolute;
            top: 80px;
            left: 0;
            width: 100%;
            height: calc(100% - 200px);
            overflow: hidden;
        }

        .game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            background: transparent;
        }

        .game-button {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 160px;
            height: 160px;
            border-radius: 50%;
            border: none;
            background: var(--primary-gradient);
            color: white;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            z-index: 200;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow: hidden;
            pointer-events: auto;
        }

        .game-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: scale(0);
            transition: var(--transition);
            z-index: -1;
        }

        .game-button:hover {
            transform: translateX(-50%) scale(1.08);
            box-shadow: 0 15px 45px rgba(102, 126, 234, 0.6);
        }

        .game-button:hover::before {
            transform: scale(1);
        }

        .game-button:active {
            transform: translateX(-50%) scale(0.95);
        }

        .game-button.pulse {
            animation: pulse 0.6s ease-out;
        }

        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.15); }
            100% { transform: translateX(-50%) scale(1); }
        }

        .button-text {
            font-size: 26px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .button-subtext {
            font-size: 14px;
            opacity: 0.8;
        }

        .menu-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 300;
            pointer-events: auto;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .menu-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .menu-content {
            background: rgba(30, 30, 60, 0.7);
            border-radius: var(--border-radius);
            padding: 40px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.15);
            max-width: 500px;
            width: 90%;
            transform: translateY(20px);
            opacity: 0;
            animation: menuAppear 0.5s forwards 0.2s;
        }

        @keyframes menuAppear {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .menu-title {
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 15px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
            position: relative;
            padding-bottom: 15px;
        }

        .menu-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: var(--primary-gradient);
            border-radius: 3px;
        }

        .menu-subtitle {
            font-size: 18px;
            margin-bottom: 30px;
            color: #ccc;
            line-height: 1.6;
        }

        .menu-button {
            background: var(--primary-gradient);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            padding: 16px 35px;
            margin: 12px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            width: 220px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .menu-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        .menu-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .menu-button.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        .leaderboard {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            border-radius: var(--border-radius);
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 20px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid var(--text-accent);
            transition: var(--transition);
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .leaderboard-rank {
            font-weight: bold;
            color: var(--text-accent);
            min-width: 30px;
            font-size: 18px;
        }

        .leaderboard-score {
            font-weight: bold;
            font-size: 18px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        .stat-item {
            text-align: center;
            padding: 20px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            transition: var(--transition);
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--text-accent);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #aaa;
        }

        .power-up {
            position: absolute;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--success-gradient);
            box-shadow: 0 0 25px rgba(79, 172, 254, 0.8);
            animation: powerUpFloat 3s ease-in-out infinite alternate;
            z-index: 50;
        }

        @keyframes powerUpFloat {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-15px); }
        }

        .character {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary-gradient);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.8);
            z-index: 60;
            transition: transform 0.1s ease;
        }

        .character.jumping {
            animation: characterJump 0.4s ease-out;
        }

        @keyframes characterJump {
            0% { transform: translateY(0); }
            50% { transform: translateY(-40px); }
            100% { transform: translateY(0); }
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 40;
            animation: particleFade 1s ease-out forwards;
        }

        @keyframes particleFade {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0) translateY(-50px);
            }
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }

        .mode-btn {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: var(--text-light);
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            min-width: 140px;
        }

        .mode-btn.active {
            background: var(--primary-gradient);
            border-color: transparent;
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .mode-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
        }

        .achievement-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: var(--transition);
        }

        .achievement-item.unlocked {
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.3);
        }

        .achievement-icon {
            font-size: 36px;
            margin-bottom: 15px;
            color: var(--text-accent);
        }

        .achievement-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .achievement-desc {
            font-size: 14px;
            color: #aaa;
        }

        .character-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }

        .character-option {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
        }

        .character-option.active {
            border-color: var(--text-accent);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 230, 191, 0.5);
        }

        .character-option:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 25px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-gradient);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .ability-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .ability {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .ability::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: var(--success-gradient);
            transition: height 0.3s ease;
            z-index: -1;
        }

        .ability.ready::after {
            height: 100%;
        }

        .ability.ready {
            background: transparent;
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.6);
            transform: scale(1.05);
        }

        .ability.cooldown {
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .game-container {
                height: 100vh;
                border-radius: 0;
            }
            
            .top-bar {
                padding: 15px 20px;
            }
            
            .score-value {
                font-size: 22px;
            }
            
            .game-button {
                width: 130px;
                height: 130px;
                bottom: 30px;
                font-size: 18px;
            }
            
            .menu-content {
                padding: 30px 20px;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .character-selector {
                flex-wrap: wrap;
            }
            
            .ability-bar {
                gap: 10px;
            }
            
            .ability {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="background-effect"></div>
        <div class="stars" id="stars"></div>
        
        <div class="ui-overlay">
            <div class="top-bar">
                <div class="score-display">
                    <div class="score-value">Score: <span id="score">0</span></div>
                    <div class="combo-display">
                        <i class="fas fa-bolt"></i>
                        Combo: <span class="combo-count" id="comboCount">0</span>x
                    </div>
                </div>
                <div class="theme-selector">
                    <div class="theme-btn classic active" data-theme="classic"></div>
                    <div class="theme-btn neon" data-theme="neon"></div>
                    <div class="theme-btn ocean" data-theme="ocean"></div>
                    <div class="theme-btn sunset" data-theme="sunset"></div>
                </div>
            </div>
        </div>

        <div class="game-canvas-container">
            <canvas class="game-canvas" id="gameCanvas"></canvas>
        </div>
        
        <button class="game-button" id="gameButton">
            <div class="button-text" id="buttonText">JUMP</div>
            <div class="button-subtext">Press SPACE or Tap</div>
        </button>

        <div class="menu-overlay" id="menuOverlay">
            <div class="menu-content">
                <h1 class="menu-title">Quantum Jump</h1>
                <p class="menu-subtitle">Master the art of perfect timing in this gravity-defying adventure</p>
                
                <div id="mainMenu">
                    <div class="mode-selector">
                        <div class="mode-btn active" data-mode="classic">Classic</div>
                        <div class="mode-btn" data-mode="endless">Endless</div>
                        <div class="mode-btn" data-mode="timed">Time Trial</div>
                    </div>
                    
                    <button class="menu-button" onclick="startGame()">
                        <i class="fas fa-play"></i> Start Game
                    </button>
                    <button class="menu-button secondary" onclick="showCharacterSelect()">
                        <i class="fas fa-user-astronaut"></i> Character
                    </button>
                    <button class="menu-button secondary" onclick="showLeaderboard()">
                        <i class="fas fa-trophy"></i> Leaderboard
                    </button>
                    <button class="menu-button secondary" onclick="showAchievements()">
                        <i class="fas fa-medal"></i> Achievements
                    </button>
                </div>

                <div id="characterMenu" style="display: none;">
                    <h2 style="margin-bottom: 20px;">Select Your Character</h2>
                    <div class="character-selector">
                        <div class="character-option active" data-char="1">üöÄ</div>
                        <div class="character-option" data-char="2">üëæ</div>
                        <div class="character-option" data-char="3">ü§ñ</div>
                        <div class="character-option" data-char="4">üëΩ</div>
                    </div>
                    <button class="menu-button" onclick="startGame()">
                        <i class="fas fa-play"></i> Start Game
                    </button>
                    <button class="menu-button secondary" onclick="showMainMenu()">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                </div>

                <div id="leaderboardMenu" style="display: none;">
                    <h2 style="margin-bottom: 20px;">Top Scores</h2>
                    <div class="leaderboard" id="leaderboardList"></div>
                    <button class="menu-button" onclick="showMainMenu()">
                        <i class="fas fa-arrow-left"></i> Back to Menu
                    </button>
                </div>

                <div id="achievementsMenu" style="display: none;">
                    <h2 style="margin-bottom: 20px;">Achievements</h2>
                    <div class="achievement-grid" id="achievementsList"></div>
                    <button class="menu-button" onclick="showMainMenu()">
                        <i class="fas fa-arrow-left"></i> Back to Menu
                    </button>
                </div>

                <div id="gameOverMenu" style="display: none;">
                    <h2 style="margin-bottom: 20px;">Game Over!</h2>
                    <div style="font-size: 32px; margin: 25px 0;">
                        Final Score: <span id="finalScore" style="color: var(--text-accent);">0</span>
                    </div>
                    <div id="newRecord" style="display: none; background: rgba(79, 172, 254, 0.2); padding: 15px; border-radius: 12px; margin: 20px 0;">
                        <i class="fas fa-trophy"></i> üèÜ New Personal Best! üèÜ
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="obstaclesPassed">0</div>
                            <div class="stat-label">Obstacles Passed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="powerupsCollected">0</div>
                            <div class="stat-label">Power-ups Collected</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="maxCombo">0</div>
                            <div class="stat-label">Max Combo</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="gameTime">0s</div>
                            <div class="stat-label">Game Duration</div>
                        </div>
                    </div>
                    
                    <button class="menu-button" onclick="startGame()">
                        <i class="fas fa-redo"></i> Play Again
                    </button>
                    <button class="menu-button secondary" onclick="showMainMenu()">
                        <i class="fas fa-home"></i> Main Menu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced game state and configuration
        const gameState = {
            isPlaying: false,
            isPaused: false,
            score: 0,
            combo: 0,
            maxCombo: 0,
            gameSpeed: 1,
            lastFrameTime: 0,
            animationId: null,
            gameMode: 'classic', // classic, endless, timed
            gameStartTime: 0,
            obstaclesPassed: 0,
            powerupsCollected: 0,
            selectedCharacter: '1'
        };

        const config = {
            player: {
                x: 150,
                y: 300,
                width: 30,
                height: 30,
                jumpForce: -18,
                gravity: 0.9,
                velocityY: 0,
                isGrounded: false,
                groundY: 350,
                doubleJumpAvailable: true
            },
            obstacles: [],
            powerUps: [],
            particles: [],
            obstacleSpawnRate: 0.015,
            powerUpSpawnRate: 0.005,
            themes: {
                classic: { primary: '#667eea', secondary: '#764ba2', accent: '#00e6bf' },
                neon: { primary: '#f093fb', secondary: '#f5576c', accent: '#00ff88' },
                ocean: { primary: '#00c6ff', secondary: '#0072ff', accent: '#4facfe' },
                sunset: { primary: '#fa709a', secondary: '#fee140', accent: '#ff6b6b' }
            },
            currentTheme: 'classic',
            characters: {
                '1': { color: '#667eea', ability: 'Double Jump' },
                '2': { color: '#f093fb', ability: 'Shield' },
                '3': { color: '#00c6ff', ability: 'Magnet' },
                '4': { color: '#fa709a', ability: 'Slow Motion' }
            },
            abilities: {
                doubleJump: { ready: true, cooldown: false },
                shield: { ready: false, cooldown: false, active: false, duration: 5000 },
                magnet: { ready: false, cooldown: false, active: false, duration: 7000 },
                slowMotion: { ready: false, cooldown: false, active: false, duration: 4000 }
            },
            achievements: [
                { id: 1, title: "First Jump", description: "Complete your first jump", unlocked: false, icon: "fa-star" },
                { id: 2, title: "Combo Master", description: "Achieve a 10x combo", unlocked: false, icon: "fa-bolt" },
                { id: 3, title: "Power Collector", description: "Collect 5 power-ups", unlocked: false, icon: "fa-gem" },
                { id: 4, title: "Obstacle Dodger", description: "Pass 50 obstacles", unlocked: false, icon: "fa-shield-alt" },
                { id: 5, title: "High Scorer", description: "Reach 500 points", unlocked: false, icon: "fa-trophy" },
                { id: 6, title: "Theme Explorer", description: "Try all themes", unlocked: false, icon: "fa-palette" }
            ]
        };

        // Game statistics
        const stats = {
            totalGames: parseInt(localStorage.getItem('totalGames')) || 0,
            bestScore: parseInt(localStorage.getItem('bestScore')) || 0,
            totalJumps: parseInt(localStorage.getItem('totalJumps')) || 0,
            totalScore: parseInt(localStorage.getItem('totalScore')) || 0,
            totalObstacles: parseInt(localStorage.getItem('totalObstacles')) || 0,
            totalPowerups: parseInt(localStorage.getItem('totalPowerups')) || 0
        };

        // DOM elements
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameButton = document.getElementById('gameButton');
        const scoreDisplay = document.getElementById('score');
        const comboDisplay = document.getElementById('comboCount');
        const menuOverlay = document.getElementById('menuOverlay');
        const comboContainer = document.querySelector('.combo-display');

        // Initialize canvas
        function initCanvas() {
            canvas.width = document.querySelector('.game-canvas-container').clientWidth;
            canvas.height = document.querySelector('.game-canvas-container').clientHeight;
            config.player.groundY = canvas.height - 100;
            config.player.y = config.player.groundY;
        }

        // Create animated star background
        function createStars() {
            const starsContainer = document.getElementById('stars');
            starsContainer.innerHTML = '';
            
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = (Math.random() * 4 + 1) + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                starsContainer.appendChild(star);
            }
        }

        // Game object classes
        class GameObject {
            constructor(x, y, width, height, color) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }

            update() {
                this.x -= 4 * gameState.gameSpeed;
            }

            isOffScreen() {
                return this.x + this.width < 0;
            }

            collidesWith(other) {
                return this.x < other.x + other.width &&
                       this.x + this.width > other.x &&
                       this.y < other.y + other.height &&
                       this.y + this.height > other.y;
            }
        }

        class Obstacle extends GameObject {
            constructor(x, y, width, height, type = 'standard') {
                let color;
                switch(type) {
                    case 'high':
                        color = config.themes[config.currentTheme].secondary;
                        break;
                    case 'low':
                        color = '#f5576c';
                        break;
                    case 'moving':
                        color = '#f093fb';
                        break;
                    default:
                        color = config.themes[config.currentTheme].primary;
                }
                
                super(x, y, width, height, color);
                this.passed = false;
                this.type = type;
                this.originalY = y;
                this.movingUp = Math.random() > 0.5;
            }

            draw() {
                // Draw with gradient and glow
                const gradient = ctx.createLinearGradient(this.x, this.y, this.x + this.width, this.y + this.height);
                gradient.addColorStop(0, this.color);
                gradient.addColorStop(1, this.type === 'high' ? '#4facfe' : '#f093fb');
                
                ctx.fillStyle = gradient;
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                ctx.shadowBlur = 0;
                
                // Add details based on type
                if (this.type === 'moving') {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/2, this.y + this.height/2, this.width/3, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            update() {
                super.update();
                
                // Add movement for moving obstacles
                if (this.type === 'moving') {
                    if (this.movingUp) {
                        this.y -= 1.5;
                        if (this.y < this.originalY - 30) this.movingUp = false;
                    } else {
                        this.y += 1.5;
                        if (this.y > this.originalY + 30) this.movingUp = true;
                    }
                }
            }
        }

        class PowerUp extends GameObject {
            constructor(x, y, type = 'standard') {
                let color;
                switch(type) {
                    case 'double':
                        color = '#00e6bf';
                        break;
                    case 'shield':
                        color = '#4facfe';
                        break;
                    case 'magnet':
                        color = '#f093fb';
                        break;
                    default:
                        color = config.themes[config.currentTheme].accent;
                }
                
                super(x, y, 30, 30, color);
                this.collected = false;
                this.pulseTime = 0;
                this.type = type;
            }

            update() {
                super.update();
                this.pulseTime += 0.1;
            }

            draw() {
                ctx.save();
                
                // Pulsing effect
                const scale = 1 + Math.sin(this.pulseTime) * 0.2;
                ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
                ctx.scale(scale, scale);
                
                // Glow effect
                ctx.shadowBlur = 20;
                ctx.shadowColor = this.color;
                
                // Draw circle
                ctx.beginPath();
                ctx.arc(0, 0, this.width / 2, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                
                // Draw icon based on type
                ctx.fillStyle = 'white';
                ctx.font = '16px FontAwesome';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                let icon;
                switch(this.type) {
                    case 'double':
                        icon = 'ÔÑ∑'; // fa-chevron-double-up
                        break;
                    case 'shield':
                        icon = 'ÔÑ≤'; // fa-shield-alt
                        break;
                    case 'magnet':
                        icon = 'ÔÅ∂'; // fa-magnet
                        break;
                    default:
                        icon = 'ÔÉß'; // fa-bolt
                }
                
                ctx.fillText(icon, 0, 0);
                
                ctx.restore();
            }
        }

        class Particle {
            constructor(x, y, vx, vy, color, life) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.color = color;
                this.life = life;
                this.maxLife = life;
                this.size = Math.random() * 4 + 2;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.2; // gravity
                this.life--;
            }

            draw() {
                const alpha = this.life / this.maxLife;
                ctx.save();
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }

            isDead() {
                return this.life <= 0;
            }
        }

        // Player management
        function updatePlayer() {
            const player = config.player;
            
            // Apply gravity
            if (!player.isGrounded) {
                player.velocityY += player.gravity;
            }
            
            // Update position
            player.y += player.velocityY;
            
            // Ground collision
            if (player.y >= player.groundY) {
                player.y = player.groundY;
                player.velocityY = 0;
                player.isGrounded = true;
                player.doubleJumpAvailable = true;
            } else {
                player.isGrounded = false;
            }
            
            // Keep player in bounds
            if (player.y < 0) {
                player.y = 0;
                player.velocityY = 0;
            }
        }

        function drawPlayer() {
            const player = config.player;
            const charColor = config.characters[gameState.selectedCharacter].color;
            
            ctx.save();
            
            // Player glow effect
            ctx.shadowBlur = 20;
            ctx.shadowColor = charColor;
            
            // Draw character
            ctx.fillStyle = charColor;
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + player.height/2, player.width/2, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw character face/icon
            ctx.fillStyle = 'white';
            ctx.font = '16px FontAwesome';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            let icon;
            switch(gameState.selectedCharacter) {
                case '1': icon = 'ÔÅä'; break; // rocket
                case '2': icon = 'ÔÜ∞'; break; // alien
                case '3': icon = 'Ôï¥'; break; // robot
                case '4': icon = 'ÔÅ∂'; break; // alien
                default: icon = 'ÔÑ∑'; // default
            }
            
            ctx.fillText(icon, player.x + player.width/2, player.y + player.height/2);
            
            ctx.restore();
        }

        // Game mechanics
        function jump() {
            if (gameState.isPlaying) {
                if (config.player.isGrounded) {
                    // Regular jump
                    config.player.velocityY = config.player.jumpForce;
                    config.player.isGrounded = false;
                    createJumpEffect();
                } else if (config.player.doubleJumpAvailable && config.abilities.doubleJump.ready) {
                    // Double jump
                    config.player.velocityY = config.player.jumpForce * 1.1;
                    config.player.doubleJumpAvailable = false;
                    createJumpEffect();
                    
                    // Activate double jump cooldown
                    config.abilities.doubleJump.ready = false;
                    config.abilities.doubleJump.cooldown = true;
                    setTimeout(() => {
                        config.abilities.doubleJump.cooldown = false;
                        config.abilities.doubleJump.ready = true;
                    }, 2000);
                }
                
                // Update stats
                stats.totalJumps++;
                localStorage.setItem('totalJumps', stats.totalJumps);
            }
        }

        function createJumpEffect() {
            // Button animation
            gameButton.classList.add('pulse');
            setTimeout(() => gameButton.classList.remove('pulse'), 600);
            
            // Create jump particles
            createParticles(config.player.x + config.player.width / 2, config.player.y + config.player.height, 8);
        }

        function spawnObstacle() {
            if (Math.random() < config.obstacleSpawnRate * gameState.gameSpeed) {
                const types = ['standard', 'high', 'low', 'moving'];
                const type = types[Math.floor(Math.random() * types.length)];
                
                let height, y;
                switch(type) {
                    case 'high':
                        height = Math.random() * 80 + 70;
                        y = canvas.height - height - 50;
                        break;
                    case 'low':
                        height = Math.random() * 40 + 30;
                        y = canvas.height - height - 50;
                        break;
                    case 'moving':
                        height = Math.random() * 60 + 50;
                        y = canvas.height - height - 50 - (Math.random() * 100 - 50);
                        break;
                    default: // standard
                        height = Math.random() * 60 + 50;
                        y = canvas.height - height - 50;
                }
                
                const obstacle = new Obstacle(canvas.width, y, 30, height, type);
                config.obstacles.push(obstacle);
            }
        }

        function spawnPowerUp() {
            if (Math.random() < config.powerUpSpawnRate) {
                const types = ['standard', 'double', 'shield', 'magnet'];
                const type = types[Math.floor(Math.random() * types.length)];
                
                const powerUp = new PowerUp(
                    canvas.width, 
                    Math.random() * (canvas.height - 200) + 100,
                    type
                );
                
                config.powerUps.push(powerUp);
            }
        }

        function createParticles(x, y, count) {
            for (let i = 0; i < count; i++) {
                const particle = new Particle(
                    x + Math.random() * 20 - 10,
                    y + Math.random() * 20 - 10,
                    (Math.random() - 0.5) * 8,
                    Math.random() * -10 - 2,
                    config.themes[config.currentTheme].accent,
                    30 + Math.random() * 20
                );
                config.particles.push(particle);
            }
        }

        function checkCollisions() {
            const player = config.player;
            
            // Check obstacle collisions
            for (let obstacle of config.obstacles) {
                if (obstacle.collidesWith(player) ){
                    if (config.abilities.shield.active) {
                        // Shield protects from one collision
                        config.abilities.shield.active = false;
                        createParticles(player.x, player.y, 15);
                    } else {
                        gameOver();
                        return;
                    }
                }
                
                // Check if passed obstacle
                if (!obstacle.passed && obstacle.x + obstacle.width < player.x) {
                    obstacle.passed = true;
                    gameState.score += 10;
                    gameState.combo++;
                    gameState.obstaclesPassed++;
                    stats.totalObstacles++;
                    
                    if (gameState.combo > gameState.maxCombo) {
                        gameState.maxCombo = gameState.combo;
                    }
                    
                    // Combo bonus
                    if (gameState.combo >= 5) {
                        gameState.score += gameState.combo * 2;
                        showCombo();
                    }
                    
                    updateScore();
                }
            }
            
            // Check power-up collisions
            for (let powerUp of config.powerUps) {
                if (!powerUp.collected && powerUp.collidesWith(player)) {
                    powerUp.collected = true;
                    gameState.score += 25;
                    gameState.combo += 2;
                    gameState.powerupsCollected++;
                    stats.totalPowerups++;
                    
                    // Power-up effects
                    createParticles(powerUp.x + powerUp.width / 2, powerUp.y + powerUp.height / 2, 15);
                    
                    // Apply power-up effect based on type
                    switch(powerUp.type) {
                        case 'double':
                            config.abilities.doubleJump.ready = true;
                            break;
                        case 'shield':
                            activateShield();
                            break;
                        case 'magnet':
                            activateMagnet();
                            break;
                    }
                    
                    updateScore();
                    checkAchievements();
                }
            }
        }

        function activateShield() {
            config.abilities.shield.active = true;
            config.abilities.shield.ready = false;
            
            // Add visual effect
            const shieldEffect = document.createElement('div');
            shieldEffect.className = 'shield-effect';
            document.querySelector('.game-canvas-container').appendChild(shieldEffect);
            
            setTimeout(() => {
                config.abilities.shield.active = false;
                shieldEffect.remove();
                
                // Start cooldown
                config.abilities.shield.cooldown = true;
                setTimeout(() => {
                    config.abilities.shield.cooldown = false;
                    config.abilities.shield.ready = true;
                }, 10000);
            }, config.abilities.shield.duration);
        }

        function activateMagnet() {
            config.abilities.magnet.active = true;
            config.abilities.magnet.ready = false;
            
            // Add visual effect
            const magnetEffect = document.createElement('div');
            magnetEffect.className = 'magnet-effect';
            document.querySelector('.game-canvas-container').appendChild(magnetEffect);
            
            setTimeout(() => {
                config.abilities.magnet.active = false;
                magnetEffect.remove();
                
                // Start cooldown
                config.abilities.magnet.cooldown = true;
                setTimeout(() => {
                    config.abilities.magnet.cooldown = false;
                    config.abilities.magnet.ready = true;
                }, 15000);
            }, config.abilities.magnet.duration);
        }

        function updateGameSpeed() {
            gameState.gameSpeed = 1 + (gameState.score / 800);
        }

        function updateScore() {
            scoreDisplay.textContent = gameState.score;
        }

        function showCombo() {
            comboDisplay.textContent = gameState.combo;
            comboContainer.classList.add('active');
            
            setTimeout(() => {
                comboContainer.classList.remove('active');
            }, 2000);
        }

        // Game state management
        function startGame() {
            gameState.isPlaying = true;
            gameState.score = 0;
            gameState.combo = 0;
            gameState.maxCombo = 0;
            gameState.gameSpeed = 1;
            gameState.obstaclesPassed = 0;
            gameState.powerupsCollected = 0;
            gameState.gameStartTime = Date.now();
            
            // Reset player
            config.player.y = config.player.groundY;
            config.player.velocityY = 0;
            config.player.isGrounded = true;
            config.player.doubleJumpAvailable = true;
            
            // Reset abilities
            for (let ability in config.abilities) {
                config.abilities[ability].ready = true;
                config.abilities[ability].cooldown = false;
                config.abilities[ability].active = false;
            }
            
            // Clear arrays
            config.obstacles = [];
            config.powerUps = [];
            config.particles = [];
            
            // Update stats
            stats.totalGames++;
            localStorage.setItem('totalGames', stats.totalGames);
            
            // Hide menu and start game loop
            hideMenu();
            updateScore();
            document.getElementById('leaderboardMenu').style.display = 'none';
            document.getElementById('statsMenu').style.display = 'none';
            document.getElementById('instructionsMenu').style.display = 'none';
            document.getElementById('gameOverMenu').style.display = 'none';
            document.getElementById('characterMenu').style.display = 'none';
            document.getElementById('achievementsMenu').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
            
            // Update button text
            document.getElementById('buttonText').textContent = 'JUMP';
        }

        function showCharacterSelect() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('characterMenu').style.display = 'block';
        }

        function showLeaderboard() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('leaderboardMenu').style.display = 'block';
            updateLeaderboardDisplay();
        }

        function showAchievements() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('achievementsMenu').style.display = 'block';
            updateAchievementsDisplay();
        }

        function showMainMenu() {
            menuOverlay.style.display = 'flex';
            document.getElementById('mainMenu').style.display = 'block';
            document.getElementById('leaderboardMenu').style.display = 'none';
            document.getElementById('statsMenu').style.display = 'none';
            document.getElementById('instructionsMenu').style.display = 'none';
            document.getElementById('gameOverMenu').style.display = 'none';
            document.getElementById('characterMenu').style.display = 'none';
            document.getElementById('achievementsMenu').style.display = 'none';
        }

        function showGameOverMenu() {
            menuOverlay.style.display = 'flex';
            document.getElementById('gameOverMenu').style.display = 'block';
            document.getElementById('mainMenu').style.display = 'none';
            
            // Update game over stats
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('obstaclesPassed').textContent = gameState.obstaclesPassed;
            document.getElementById('powerupsCollected').textContent = gameState.powerupsCollected;
            document.getElementById('maxCombo').textContent = gameState.maxCombo;
            
            // Calculate game time
            const gameTime = Math.floor((Date.now() - gameState.gameStartTime) / 1000);
            document.getElementById('gameTime').textContent = gameTime + 's';
            
            // Check for new record
            if (gameState.score > stats.bestScore) {
                stats.bestScore = gameState.score;
                document.getElementById('newRecord').style.display = 'block';
                localStorage.setItem('bestScore', stats.bestScore);
            } else {
                document.getElementById('newRecord').style.display = 'none';
            }
            
            // Update button text
            document.getElementById('buttonText').textContent = 'PLAY AGAIN';
        }

        function hideMenu() {
            menuOverlay.classList.add('hidden');
        }

        // Leaderboard system
        function saveScore(score) {
            let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
            const entry = {
                score: score,
                date: new Date().toLocaleDateString(),
                timestamp: Date.now(),
                mode: gameState.gameMode
            };
            
            leaderboard.push(entry);
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 10); // Keep top 10
            
            localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
        }

        function updateLeaderboardDisplay() {
            const leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
            const leaderboardList = document.getElementById('leaderboardList');
            
            if (leaderboard.length === 0) {
                leaderboardList.innerHTML = '<div style="text-align: center; color: #ccc; padding: 20px;">No scores yet. Play your first game!</div>';
                return;
            }
            
            leaderboardList.innerHTML = leaderboard.map((entry, index) => `
                <div class="leaderboard-item">
                    <div class="leaderboard-rank">#${index + 1}</div>
                    <div>${entry.date} (${entry.mode})</div>
                    <div class="leaderboard-score">${entry.score}</div>
                </div>
            `).join('');
        }

        // Achievements system
        function checkAchievements() {
            // Combo Master
            if (gameState.combo >= 10 && !config.achievements[1].unlocked) {
                config.achievements[1].unlocked = true;
                showAchievementNotification(config.achievements[1].title);
            }
            
            // Power Collector
            if (stats.totalPowerups >= 5 && !config.achievements[2].unlocked) {
                config.achievements[2].unlocked = true;
                showAchievementNotification(config.achievements[2].title);
            }
            
            // Obstacle Dodger
            if (stats.totalObstacles >= 50 && !config.achievements[3].unlocked) {
                config.achievements[3].unlocked = true;
                showAchievementNotification(config.achievements[3].title);
            }
            
            // High Scorer
            if (gameState.score >= 500 && !config.achievements[4].unlocked) {
                config.achievements[4].unlocked = true;
                showAchievementNotification(config.achievements[4].title);
            }
            
            // Save achievements
            localStorage.setItem('achievements', JSON.stringify(config.achievements));
        }

        function showAchievementNotification(title) {
            const notification = document.createElement('div');
            notification.className = 'achievement-notification';
            notification.innerHTML = `
                <div class="achievement-icon"><i class="fas fa-medal"></i></div>
                <div class="achievement-title">Achievement Unlocked!</div>
                <div class="achievement-desc">${title}</div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function updateAchievementsDisplay() {
            const achievementsList = document.getElementById('achievementsList');
            
            // Load saved achievements
            const savedAchievements = JSON.parse(localStorage.getItem('achievements'));
            if (savedAchievements) {
                config.achievements = savedAchievements;
            }
            
            achievementsList.innerHTML = config.achievements.map(achievement => `
                <div class="achievement-item ${achievement.unlocked ? 'unlocked' : ''}">
                    <div class="achievement-icon"><i class="fas ${achievement.icon}"></i></div>
                    <div class="achievement-title">${achievement.title}</div>
                    <div class="achievement-desc">${achievement.description}</div>
                </div>
            `).join('');
        }

        // Theme system
        function initThemes() {
            const themeButtons = document.querySelectorAll('.theme-btn');
            themeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    themeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    switchTheme(btn.dataset.theme);
                });
            });
        }

        function switchTheme(themeName) {
            config.currentTheme = themeName;
            const theme = config.themes[themeName];
            
            // Update CSS custom properties
            document.documentElement.style.setProperty('--primary-gradient', 
                `linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%)`);
            document.documentElement.style.setProperty('--text-accent', theme.accent);
            
            localStorage.setItem('selectedTheme', themeName);
            
            // Check for Theme Explorer achievement
            let themesTried = new Set(JSON.parse(localStorage.getItem('themesTried')) || []);
            themesTried.add(themeName);
            localStorage.setItem('themesTried', JSON.stringify([...themesTried]));
            
            if (themesTried.size >= 4 && !config.achievements[5].unlocked) {
                config.achievements[5].unlocked = true;
                showAchievementNotification(config.achievements[5].title);
                localStorage.setItem('achievements', JSON.stringify(config.achievements));
            }
        }

        // Game mode selection
        function initGameModes() {
            const modeButtons = document.querySelectorAll('.mode-btn');
            modeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    modeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    gameState.gameMode = btn.dataset.mode;
                });
            });
        }

        // Character selection
        function initCharacterSelection() {
            const charOptions = document.querySelectorAll('.character-option');
            charOptions.forEach(option => {
                option.addEventListener('click', () => {
                    charOptions.forEach(o => o.classList.remove('active'));
                    option.classList.add('active');
                    gameState.selectedCharacter = option.dataset.char;
                });
            });
        }

        // Main game loop
        function gameLoop() {
            gameState.animationId = requestAnimationFrame(gameLoop);
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (gameState.isPlaying && !gameState.isPaused) {
                // Update game objects
                updatePlayer();
                updateGameSpeed();
                
                // Spawn objects
                spawnObstacle();
                spawnPowerUp();
                
                // Update obstacles
                config.obstacles = config.obstacles.filter(obstacle => {
                    obstacle.update();
                    return !obstacle.isOffScreen();
                });
                
                // Update power-ups
                config.powerUps = config.powerUps.filter(powerUp => {
                    if (!powerUp.collected) {
                        powerUp.update();
                        
                        // Magnet effect
                        if (config.abilities.magnet.active) {
                            const player = config.player;
                            const dx = (player.x + player.width/2) - (powerUp.x + powerUp.width/2);
                            const dy = (player.y + player.height/2) - (powerUp.y + powerUp.height/2);
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            
                            if (dist < 300) {
                                powerUp.x += dx * 0.05;
                                powerUp.y += dy * 0.05;
                            }
                        }
                        
                        return !powerUp.isOffScreen();
                    }
                    return false;
                });
                
                // Update particles
                config.particles = config.particles.filter(particle => {
                    particle.update();
                    return !particle.isDead();
                });
                
                // Check collisions
                checkCollisions();
            }
            
            // Draw everything
            drawPlayer();
            
            config.obstacles.forEach(obstacle => obstacle.draw());
            config.powerUps.forEach(powerUp => powerUp.draw());
            config.particles.forEach(particle => particle.draw());
        }

        function gameOver() {
            gameState.isPlaying = false;
            gameState.combo = 0;
            
            // Update statistics
            stats.totalScore += gameState.score;
            localStorage.setItem('totalScore', stats.totalScore);
            localStorage.setItem('totalObstacles', stats.totalObstacles);
            localStorage.setItem('totalPowerups', stats.totalPowerups);
            
            // Save to leaderboard
            saveScore(gameState.score);
            
            // Show game over screen
            showGameOverMenu();
        }

        // Event listeners
        function initEventListeners() {
            gameButton.addEventListener('click', jump);
            
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    jump();
                }
                
                if (e.code === 'Escape' && gameState.isPlaying) {
                    gameState.isPaused = !gameState.isPaused;
                }
            });
            
            window.addEventListener('resize', initCanvas);
            
            // Touch support for mobile
            gameButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                jump();
            });
            
            // Prevent context menu on long press
            gameButton.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });
        }

        // Initialization
        function init() {
            initCanvas();
            createStars();
            initThemes();
            initGameModes();
            initCharacterSelection();
            initEventListeners();
            
            // Load saved theme
            const savedTheme = localStorage.getItem('selectedTheme') || 'classic';
            switchTheme(savedTheme);
            document.querySelector(`[data-theme="${savedTheme}"]`).classList.add('active');
            
            // Start game loop
            gameLoop();
            
            // Load achievements
            updateAchievementsDisplay();
        }

        // Start the game
        init();
    </script>
</body>
</html>